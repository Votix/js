var headerN = "Похожие статьи:"; var header1 = "Другие материалы по теме статьи:"; var header0 = ""; var homeUrl3 = "https://www.votix.ru/"; var maxNumberOfPostsPerLabel = 15; var maxNumberOfLabels = 1; var excludeEmptyLabels = true; var excludeLabels = []; var renameLabels = {}; function is_in(item, array) { for (k in array) if (array[k] == item) return true; return false; } function label_title(label) { if (renameLabels[label]) return renameLabels[label]; return label; } totalLabels = 0; receivedReplies = 0; var receivedItems = []; var k_label; function labelReceived() { receivedReplies++; if (receivedReplies != totalLabels) return; var labelCount = 0; for (k_label in receivedItems) { var items = receivedItems[k_label]; if (items.length == 0 && excludeEmptyLabels) continue; labelCount++; } var labelCount1 = 0; for (k_label in receivedItems) { var items = receivedItems[k_label]; if (items.length == 0 && excludeEmptyLabels) continue; var ul = document.createElement('ul'); var itemsCount = 0; for (var k_item in items) { item = items[k_item]; var li = document.createElement('li'); var a = document.createElement('a'); a.href = item.href; var txt = document.createTextNode(item.title); a.appendChild(txt); li.appendChild(a); ul.appendChild(li); itemsCount++; if (itemsCount == maxNumberOfPostsPerLabel) break; } var txt = document.createTextNode(k_label); var h = document.createElement('b'); h.appendChild(txt); var div1 = document.createElement('div'); if (!(labelCount == 1 && header1.search && header1.search() != -1)) div1.appendChild(h); div1.appendChild(ul); document.getElementById('votixrelated2').appendChild(div1); labelCount1++; if (labelCount1 == maxNumberOfLabels) break; } var txt; if (labelCount == 1 && headerN) txt = document.createTextNode(header1.replace("__LABEL__", k_label)); else if (labelCount) txt = document.createTextNode(headerN); else if (header0) txt = document.createTextNode(headerN); if (txt) { var h = document.createElement("span"); h.appendChild(txt); document.getElementById('votixrelated1').appendChild(h); } } function receiveReply_123(json) { var label = ""; for (var l = 0; l < json.feed.link.length; l++) { if (json.feed.link[l].rel == 'alternate') { var raw = json.feed.link[l].href; var label = raw.substr(homeUrl3.length+13); var k; for (k=0; k<20; k++) label = label.replace("%20", " "); label = decodeURI(label); break; } } var labelTitle = label_title(label); if (typeof receivedItems[labelTitle] != "object") receivedItems[labelTitle] = []; for (var k in json.feed.entry) { var entry = json.feed.entry[k]; var href = ""; for (var kl in entry.link) { if (entry.link[kl].rel == "alternate") { href = entry.link[kl].href; break; } } if(href != "" && href != location.href) { var item = { "href" : href, "title" : entry.title.$t}; receivedItems[labelTitle].push(item); } } labelReceived(); } function sendQueryForLabel(query, label) { var script = document.createElement('script'); script.setAttribute('src', query + 'feeds/posts/default/-/' + label + '?alt=json-in-script&callback=receiveReply_123'); script.setAttribute('type', 'text/javascript'); document.documentElement.firstChild.appendChild(script); } var parsedlabels = []; var labelsCount = 0; function list_items(textLabel) { if (labelsCount >= maxNumberOfLabels || is_in(textLabel, excludeLabels) || is_in(textLabel, parsedlabels)) { labelReceived(); return; } labelsCount++; parsedlabels.push(textLabel); sendQueryForLabel(homeUrl3, textLabel); }   totalLabels++;     list_items("Разное");  
